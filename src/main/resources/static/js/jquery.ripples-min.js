!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(e.$)}(this,function(e){"use strict";function t(e){return"%"==e[e.length-1]}function r(e,t,r){function i(e,t){var r=o.createShader(e);if(o.shaderSource(r,t),o.compileShader(r),!o.getShaderParameter(r,o.COMPILE_STATUS))throw Error("compile error: "+o.getShaderInfoLog(r));return r}var n={};if(n.id=o.createProgram(),o.attachShader(n.id,i(o.VERTEX_SHADER,e)),o.attachShader(n.id,i(o.FRAGMENT_SHADER,t)),o.linkProgram(n.id),!o.getProgramParameter(n.id,o.LINK_STATUS))throw Error("link error: "+o.getProgramInfoLog(n.id));n.uniforms={},n.locations={},o.useProgram(n.id),o.enableVertexAttribArray(0);for(var a,s,u=/uniform (\w+) (\w+)/g,h=e+t;null!=(a=u.exec(h));)s=a[2],n.locations[s]=o.getUniformLocation(n.id,s);return n}function i(e,t){o.activeTexture(o.TEXTURE0+(t||0)),o.bindTexture(o.TEXTURE_2D,e)}function n(e){var t=/url\(["']?([^"']*)["']?\)/.exec(e);return null==t?null:t[1]}var o,a=(e=e&&"default"in e?e.default:e)(window),s=function(){function e(e,t,i){var n="OES_texture_"+e,o=n+"_linear",a=o in r,s=[n];return a&&s.push(o),{type:t,arrayType:i,linearSupport:a,extensions:s}}var t=document.createElement("canvas");if(!(o=t.getContext("webgl")||t.getContext("experimental-webgl")))return null;var r={};if(["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear"].forEach(function(e){var t=o.getExtension(e);t&&(r[e]=t)}),!r.OES_texture_float)return null;var i=[];i.push(e("float",o.FLOAT,Float32Array)),r.OES_texture_half_float&&i.push(e("half_float",r.OES_texture_half_float.HALF_FLOAT_OES,null));var n=o.createTexture(),a=o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,a),o.bindTexture(o.TEXTURE_2D,n),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);for(var s=null,u=0;u<i.length;u++)if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,32,32,0,o.RGBA,i[u].type,null),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n,0),o.checkFramebufferStatus(o.FRAMEBUFFER)===o.FRAMEBUFFER_COMPLETE){s=i[u];break}return s}(),u=function(e,t){try{return new ImageData(e,t)}catch(r){return document.createElement("canvas").getContext("2d").createImageData(e,t)}}(32,32);e("head").prepend("<style>.jquery-ripples { position: relative; z-index: 0; }</style>");var h=function(t,r){function i(){n.destroyed||(n.step(),requestAnimationFrame(i))}var n=this;this.$el=e(t),this.interactive=r.interactive,this.resolution=r.resolution,this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]),this.perturbance=r.perturbance,this.dropRadius=r.dropRadius,this.crossOrigin=r.crossOrigin,this.imageUrl=r.imageUrl;var a=document.createElement("canvas");a.width=this.$el.innerWidth(),a.height=this.$el.innerHeight(),this.canvas=a,this.$canvas=e(a),this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:-1}),this.$el.addClass("jquery-ripples").append(a),this.context=o=a.getContext("webgl")||a.getContext("experimental-webgl"),s.extensions.forEach(function(e){o.getExtension(e)}),this.updateSize=this.updateSize.bind(this),e(window).on("resize",this.updateSize),this.textures=[],this.framebuffers=[],this.bufferWriteIndex=0,this.bufferReadIndex=1;for(var u=s.arrayType,h=u?new u(this.resolution*this.resolution*4):null,c=0;c<2;c++){var d=o.createTexture(),f=o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,f),o.bindTexture(o.TEXTURE_2D,d),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s.linearSupport?o.LINEAR:o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s.linearSupport?o.LINEAR:o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,this.resolution,this.resolution,0,o.RGBA,s.type,h),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,d,0),this.textures.push(d),this.framebuffers.push(f)}this.quad=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.quad),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),o.STATIC_DRAW),this.initShaders(),this.initTexture(),this.setTransparentTexture(),this.loadImage(),o.clearColor(0,0,0,0),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),this.visible=!0,this.running=!0,this.inited=!0,this.destroyed=!1,this.setupPointerEvents(),requestAnimationFrame(i)};h.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:.03,interactive:!0,crossOrigin:""},h.prototype={setupPointerEvents:function(){function e(e,r){t.visible&&t.running&&t.interactive&&t.dropAtPointer(e,t.dropRadius*(r?1.5:1),r?.14:.01)}var t=this;this.$el.on("mousemove.ripples",function(t){e(t)}).on("touchmove.ripples touchstart.ripples",function(t){for(var r=t.originalEvent.changedTouches,i=0;i<r.length;i++)e(r[i])}).on("mousedown.ripples",function(t){e(t,!0)})},loadImage:function(){var e=this;o=this.context;var t=this.imageUrl||n(this.originalCssBackgroundImage)||n(this.$el.css("backgroundImage"));if(t!=this.imageSource){if(this.imageSource=t,this.imageSource){var r,i=new Image;i.onload=function(){function t(e){return 0==(e&e-1)}o=e.context;var r=t(i.width)&&t(i.height)?o.REPEAT:o.CLAMP_TO_EDGE;o.bindTexture(o.TEXTURE_2D,e.backgroundTexture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i),e.backgroundWidth=i.width,e.backgroundHeight=i.height,e.hideCssBackground()},i.onerror=function(){o=e.context,e.setTransparentTexture()},r=this.imageSource,i.crossOrigin=r.match(/^data:/)?null:this.crossOrigin,i.src=this.imageSource}else this.setTransparentTexture()}},step:function(){o=this.context,this.visible&&(this.computeTextureBoundaries(),this.running&&this.update(),this.render())},drawQuad:function(){o.bindBuffer(o.ARRAY_BUFFER,this.quad),o.vertexAttribPointer(0,2,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLE_FAN,0,4)},render:function(){o.bindFramebuffer(o.FRAMEBUFFER,null),o.viewport(0,0,this.canvas.width,this.canvas.height),o.enable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.useProgram(this.renderProgram.id),i(this.backgroundTexture,0),i(this.textures[0],1),o.uniform1f(this.renderProgram.locations.perturbance,this.perturbance),o.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft),o.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight),o.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio),o.uniform1i(this.renderProgram.locations.samplerBackground,0),o.uniform1i(this.renderProgram.locations.samplerRipples,1),this.drawQuad(),o.disable(o.BLEND)},update:function(){o.viewport(0,0,this.resolution,this.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),i(this.textures[this.bufferReadIndex]),o.useProgram(this.updateProgram.id),this.drawQuad(),this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex,this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var e,r=this.$el.css("background-size"),i=this.$el.css("background-attachment"),n=function e(t){var r=t.split(" ");if(1!==r.length)return r.map(function(e){switch(t){case"center":return"50%";case"top":case"left":return"0";case"right":case"bottom":return"100%";default:return e}});switch(t){case"center":return["50%","50%"];case"top":return["50%","0"];case"bottom":return["50%","100%"];case"left":return["0","50%"];case"right":return["100%","50%"];default:return[t,"50%"]}}(this.$el.css("background-position"));if("fixed"==i?((e={left:window.pageXOffset,top:window.pageYOffset}).width=a.width(),e.height=a.height()):((e=this.$el.offset()).width=this.$el.innerWidth(),e.height=this.$el.innerHeight()),"cover"==r)var o=Math.max(e.width/this.backgroundWidth,e.height/this.backgroundHeight),s=this.backgroundWidth*o,u=this.backgroundHeight*o;else if("contain"==r)var o=Math.min(e.width/this.backgroundWidth,e.height/this.backgroundHeight),s=this.backgroundWidth*o,u=this.backgroundHeight*o;else{var s=(r=r.split(" "))[0]||"",u=r[1]||s;t(s)?s=e.width*parseFloat(s)/100:"auto"!=s&&(s=parseFloat(s)),t(u)?u=e.height*parseFloat(u)/100:"auto"!=u&&(u=parseFloat(u)),"auto"==s&&"auto"==u?(s=this.backgroundWidth,u=this.backgroundHeight):("auto"==s&&(s=this.backgroundWidth*(u/this.backgroundHeight)),"auto"==u&&(u=this.backgroundHeight*(s/this.backgroundWidth)))}var h=n[0],c=n[1];h=t(h)?e.left+(e.width-s)*parseFloat(h)/100:e.left+parseFloat(h),c=t(c)?e.top+(e.height-u)*parseFloat(c)/100:e.top+parseFloat(c);var d=this.$el.offset();this.renderProgram.uniforms.topLeft=new Float32Array([(d.left-h)/s,(d.top-c)/u]),this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/s,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/u]);var f=Math.max(this.canvas.width,this.canvas.height);this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/f,this.canvas.height/f])},initShaders:function(){var e="attribute vec2 vertex;\nvarying vec2 coord;\nvoid main() {\ncoord = vertex * 0.5 + 0.5;\ngl_Position = vec4(vertex, 0.0, 1.0);\n}";this.dropProgram=r(e,"precision highp float;\nconst float PI = 3.141592653589793;\nuniform sampler2D texture;\nuniform vec2 center;\nuniform float radius;\nuniform float strength;\nvarying vec2 coord;\nvoid main() {\nvec4 info = texture2D(texture, coord);\nfloat drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);\ndrop = 0.5 - cos(drop * PI) * 0.5;\ninfo.r += drop * strength;\ngl_FragColor = info;\n}"),this.updateProgram=r(e,"precision highp float;\nuniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 coord;\nvoid main() {\nvec4 info = texture2D(texture, coord);\nvec2 dx = vec2(delta.x, 0.0);\nvec2 dy = vec2(0.0, delta.y);\nfloat average = (\ntexture2D(texture, coord - dx).r +\ntexture2D(texture, coord - dy).r +\ntexture2D(texture, coord + dx).r +\ntexture2D(texture, coord + dy).r\n) * 0.25;\ninfo.g += (average - info.r) * 2.0;\ninfo.g *= 0.995;\ninfo.r += info.g;\ngl_FragColor = info;\n}"),o.uniform2fv(this.updateProgram.locations.delta,this.textureDelta),this.renderProgram=r("precision highp float;\nattribute vec2 vertex;\nuniform vec2 topLeft;\nuniform vec2 bottomRight;\nuniform vec2 containerRatio;\nvarying vec2 ripplesCoord;\nvarying vec2 backgroundCoord;\nvoid main() {\nbackgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);\nbackgroundCoord.y = 1.0 - backgroundCoord.y;\nripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;\ngl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);\n}","precision highp float;\nuniform sampler2D samplerBackground;\nuniform sampler2D samplerRipples;\nuniform vec2 delta;\nuniform float perturbance;\nvarying vec2 ripplesCoord;\nvarying vec2 backgroundCoord;\nvoid main() {\nfloat height = texture2D(samplerRipples, ripplesCoord).r;\nfloat heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;\nfloat heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;\nvec3 dx = vec3(delta.x, heightX - height, 0.0);\nvec3 dy = vec3(0.0, heightY - height, delta.y);\nvec2 offset = -normalize(cross(dy, dx)).xz;\nfloat specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);\ngl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;\n}"),o.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.backgroundTexture),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)},setTransparentTexture:function(){o.bindTexture(o.TEXTURE_2D,this.backgroundTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,u)},hideCssBackground:function(){var e=this.$el[0].style.backgroundImage;"none"!=e&&(this.originalInlineCss=e,this.originalCssBackgroundImage=this.$el.css("backgroundImage"),this.$el.css("backgroundImage","none"))},restoreCssBackground:function(){this.$el.css("backgroundImage",this.originalInlineCss||"")},dropAtPointer:function(e,t,r){var i=parseInt(this.$el.css("border-left-width"))||0,n=parseInt(this.$el.css("border-top-width"))||0;this.drop(e.pageX-this.$el.offset().left-i,e.pageY-this.$el.offset().top-n,t,r)},drop:function(e,t,r,n){o=this.context;var a=this.$el.innerWidth(),s=this.$el.innerHeight(),u=Math.max(a,s);r/=u;var h=new Float32Array([(2*e-a)/u,(s-2*t)/u]);o.viewport(0,0,this.resolution,this.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),i(this.textures[this.bufferReadIndex]),o.useProgram(this.dropProgram.id),o.uniform2fv(this.dropProgram.locations.center,h),o.uniform1f(this.dropProgram.locations.radius,r),o.uniform1f(this.dropProgram.locations.strength,n),this.drawQuad(),this.swapBufferIndices()},updateSize:function(){var e=this.$el.innerWidth(),t=this.$el.innerHeight();e==this.canvas.width&&t==this.canvas.height||(this.canvas.width=e,this.canvas.height=t)},destroy:function(){this.$el.off(".ripples").removeClass("jquery-ripples").removeData("ripples"),o=null,e(window).off("resize",this.updateSize),this.$canvas.remove(),this.restoreCssBackground(),this.destroyed=!0},show:function(){this.visible=!0,this.$canvas.show(),this.hideCssBackground()},hide:function(){this.visible=!1,this.$canvas.hide(),this.restoreCssBackground()},pause:function(){this.running=!1},play:function(){this.running=!0},set:function(e,t){switch(e){case"dropRadius":case"perturbance":case"interactive":case"crossOrigin":this[e]=t;break;case"imageUrl":this.imageUrl=t,this.loadImage()}}};var c=e.fn.ripples;e.fn.ripples=function(t){if(!s)throw Error("Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.");var r=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var i=e(this),n=i.data("ripples"),o=e.extend({},h.DEFAULTS,i.data(),"object"==typeof t&&t);(n||"string"!=typeof t)&&(n?"string"==typeof t&&h.prototype[t].apply(n,r):i.data("ripples",n=new h(this,o)))})},e.fn.ripples.Constructor=h,e.fn.ripples.noConflict=function(){return e.fn.ripples=c,this}});